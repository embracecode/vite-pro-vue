import{bf as y,r as p,bg as x,O as re,au as D,a as ue,o as de,f as R,s as F,y as e,w as t,k as l,bd as k,W as m,j as z,t as M,g as P,p as ie,F as J,am as ce,Y as me,Z as pe,a0 as fe,$ as ge,a1 as ve,a2 as _e,a3 as Ce,M as he}from"./index-Rm7tvSTH.js";import{E as be,a as ke,b as ye,c as Ue,d as Ve}from"./el-table-column-BpANfTtk.js";import{E as we}from"./el-drawer-CVg_H9Xf.js";import"./el-overlay-CN1xueOC.js";import{E as xe}from"./el-pagination-BbcnGJqi.js";/* empty css                   */import{u as Ee}from"./setting-DB6iCzVN.js";import"./vnode-BLdlz9xG.js";const Se=(a,n,s)=>y.get(`/admin/acl/user/${a}/${n}/?username=${s}`),Re=a=>a.id?y.put("/admin/acl/user/update",a):y.post("/admin/acl/user/save",a),ze=a=>y.get("/admin/acl/user/toAssign/"+a),Ie=a=>y.post("/admin/acl/user/doAssignRole",a),Ae=a=>y.delete("/admin/acl/user/remove/"+a),qe=a=>y.delete("/admin/acl/user/batchRemove",{data:a}),Ne=()=>{let a=p(1),n=p(5),s=p(0),d=p([]),f=p(""),c=p([]);const g=async(_=1)=>{a.value=_;let i=await Se(a.value,n.value,f.value);i.code===200&&(s.value=i.data.total,d.value=i.data.records)};return{pageNo:a,pageSize:n,total:s,userArr:d,getHasUser:g,keyword:f,selectIdArr:c,selectChange:_=>{c.value=_},deleteUser:async _=>{(await Ae(_)).code===200&&(x({type:"success",message:"删除成功"}),g(d.value.length>1?a.value:a.value-1))},deleteSelectUser:async()=>{let _=c.value.map(u=>u.id);(await qe(_)).code===200&&(x({type:"success",message:"删除成功"}),g(d.value.length>1?a.value:a.value-1))},search:()=>{g(),f.value=""}}},$e=a=>{let n=p(!1),s=re({username:"",name:"",password:""}),d=p();return{upUserInfo:n,userParams:s,formRef:d,addUser:()=>{n.value=!0,Object.assign(s,{id:0,username:"",name:"",password:""}),D(()=>{d.value.clearValidate("username"),d.value.clearValidate("name"),d.value.clearValidate("password")})},updateUser:V=>{n.value=!0,Object.assign(s,V),D(()=>{d.value.clearValidate("username"),d.value.clearValidate("name")})},save:async()=>{d.value.validate(),(await Re(s)).code===200?(n.value=!1,x({type:"success",message:s.id?"更新成功":"添加成功"}),a()):(n.value=!1,x({type:"error",message:s.id?"更新失败":"添加失败"}))},cancel:()=>{n.value=!1},rules:{username:[{required:!0,trigger:"blur",validator:Le}],name:[{required:!0,trigger:"blur",validator:Oe}],password:[{required:!0,trigger:"blur",validator:Te}]}}},Le=(a,n,s)=>{n.trim().length>=5?s():s(new Error("用户名字至少五位"))},Oe=(a,n,s)=>{n.trim().length>=5?s():s(new Error("用户昵称至少五位"))},Te=(a,n,s)=>{n.trim().length>=5?s():s(new Error("用户密码至少六位"))},je=(a,n,s)=>{let d=p(!1),f=p([]),c=p([]);const g=async i=>{d.value=!0,Object.assign(a,i);let u=await ze(a.id);u.code===200&&(f.value=u.data.allRolesList,c.value=u.data.assignRoles,d.value=!0)},U=p(!1),h=p(!0);return{distributeJob:d,allRole:f,userRole:c,setRole:g,checkAll:U,isIndeterminate:h,handleCheckAllChange:i=>{console.log(i,"val"),c.value=i?f.value:[],h.value=!1},handleCheckedUsersChange:i=>{console.log(i,"value");const u=i.length;U.value=u===f.value.length,h.value=u>0&&u<f.value.length},confirmClick:async()=>{let i={userId:a.id,roleIdList:c.value.map(A=>A.id)};(await Ie(i)).code===200&&(x({type:"success",message:"分配职务成功"}),d.value=!1,n(s.value))}}},De=a=>(_e("data-v-7fdf2411"),a=a(),Ce(),a),Fe={style:{flex:"auto"}},Me=De(()=>z("h4",null,"分配角色",-1)),Pe={style:{flex:"auto"}},Je=ue({__name:"index",setup(a){const{pageNo:n,pageSize:s,total:d,userArr:f,getHasUser:c,keyword:g,selectIdArr:U,selectChange:h,deleteUser:V,deleteSelectUser:I,search:_}=Ne(),{upUserInfo:i,userParams:u,formRef:A,addUser:B,updateUser:G,save:H,cancel:W,rules:Y}=$e(c),{distributeJob:E,allRole:Z,userRole:q,setRole:K,checkAll:N,isIndeterminate:Q,handleCheckAllChange:X,handleCheckedUsersChange:ee,confirmClick:le}=je(u,c,n);de(()=>{c()});let L=Ee();const ae=()=>{L.refsh=!L.refsh};return(Be,r)=>{const w=me,b=pe,v=fe,$=ge,O=ve,C=be,te=ke,oe=ye,se=xe,T=we,j=Ue,ne=Ve;return R(),F(J,null,[e(O,{style:{height:"80px"}},{default:t(()=>[e($,{inline:!0,class:"form"},{default:t(()=>[e(b,{label:"用户名:"},{default:t(()=>[e(w,{placeholder:"请你输入搜索用户名",modelValue:l(g),"onUpdate:modelValue":r[0]||(r[0]=o=>k(g)?g.value=o:null)},null,8,["modelValue"])]),_:1}),e(b,null,{default:t(()=>[e(v,{type:"primary",size:"default",disabled:!l(g).length,onClick:l(_)},{default:t(()=>[m(" 搜索 ")]),_:1},8,["disabled","onClick"]),e(v,{size:"default",onClick:ae},{default:t(()=>[m("重置")]),_:1})]),_:1})]),_:1})]),_:1}),e(O,{style:{margin:"10px 0"}},{default:t(()=>[e(v,{type:"primary",size:"default",onClick:l(B)},{default:t(()=>[m(" 添加用户 ")]),_:1},8,["onClick"]),e(v,{type:"danger",size:"default",disabled:!l(U).length,onClick:l(I)},{default:t(()=>[m(" 批量删除 ")]),_:1},8,["disabled","onClick"]),e(oe,{style:{margin:"10px 0"},border:"",data:l(f),onSelectionChange:l(h)},{default:t(()=>[e(C,{type:"selection",align:"center"}),e(C,{label:"#",align:"center",type:"index"}),e(C,{label:"id",align:"center",prop:"id"}),e(C,{label:"用户名字",align:"center",prop:"username","show-overflow-tooltip":""}),e(C,{label:"用户名称",align:"center",prop:"name","show-overflow-tooltip":""}),e(C,{label:"用户角色",align:"center",prop:"roleName","show-overflow-tooltip":""}),e(C,{label:"创建时间",align:"center",prop:"createTime","show-overflow-tooltip":""}),e(C,{label:"更新时间",align:"center",prop:"updateTime","show-overflow-tooltip":""}),e(C,{label:"操作",width:"300px",align:"center"},{default:t(({row:o})=>[e(v,{size:"small",icon:"User",onClick:S=>l(K)(o)},{default:t(()=>[m(" 分配角色 ")]),_:2},1032,["onClick"]),e(v,{type:"primary",size:"small",icon:"Edit",onClick:S=>l(G)(o)},{default:t(()=>[m(" 编辑 ")]),_:2},1032,["onClick"]),e(te,{title:`你确定删除${o.username}`,width:"260px",onConfirm:S=>l(V)(o.id)},{reference:t(()=>[e(v,{type:"danger",size:"small",icon:"Delete"},{default:t(()=>[m(" 删除 ")]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data","onSelectionChange"]),e(se,{"current-page":l(n),"onUpdate:currentPage":r[1]||(r[1]=o=>k(n)?n.value=o:null),"page-size":l(s),"onUpdate:pageSize":r[2]||(r[2]=o=>k(s)?s.value=o:null),"page-sizes":[5,7,9,11],background:!0,layout:"prev, pager, next, jumper, -> , sizes, total",total:l(d),onCurrentChange:l(c),onSizeChange:l(c)},null,8,["current-page","page-size","total","onCurrentChange","onSizeChange"])]),_:1}),e(T,{modelValue:l(i),"onUpdate:modelValue":r[6]||(r[6]=o=>k(i)?i.value=o:null)},{header:t(()=>[z("h4",null,M(l(u).id?"更新用户":"添加用户"),1)]),default:t(()=>[e($,{model:l(u),rules:l(Y),ref_key:"formRef",ref:A},{default:t(()=>[e(b,{label:"用户姓名",prop:"username"},{default:t(()=>[e(w,{placeholder:"请您输入用户姓名",modelValue:l(u).username,"onUpdate:modelValue":r[3]||(r[3]=o=>l(u).username=o)},null,8,["modelValue"])]),_:1}),e(b,{label:"用户昵称",prop:"name"},{default:t(()=>[e(w,{placeholder:"请您输入用户昵称",modelValue:l(u).name,"onUpdate:modelValue":r[4]||(r[4]=o=>l(u).name=o)},null,8,["modelValue"])]),_:1}),l(u).id?ie("",!0):(R(),P(b,{key:0,label:"用户密码",prop:"password"},{default:t(()=>[e(w,{placeholder:"请您输入用户密码",modelValue:l(u).password,"onUpdate:modelValue":r[5]||(r[5]=o=>l(u).password=o)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model","rules"])]),footer:t(()=>[z("div",Fe,[e(v,{onClick:l(W)},{default:t(()=>[m("取消")]),_:1},8,["onClick"]),e(v,{type:"primary",onClick:l(H)},{default:t(()=>[m("确定")]),_:1},8,["onClick"])])]),_:1},8,["modelValue"]),e(T,{modelValue:l(E),"onUpdate:modelValue":r[11]||(r[11]=o=>k(E)?E.value=o:null)},{header:t(()=>[Me]),default:t(()=>[e($,null,{default:t(()=>[e(b,{label:"用户姓名"},{default:t(()=>[e(w,{modelValue:l(u).username,"onUpdate:modelValue":r[7]||(r[7]=o=>l(u).username=o),disabled:!0},null,8,["modelValue"])]),_:1}),e(b,{label:"职位列表"},{default:t(()=>[e(j,{modelValue:l(N),"onUpdate:modelValue":r[8]||(r[8]=o=>k(N)?N.value=o:null),indeterminate:l(Q),onChange:l(X)},{default:t(()=>[m(" 全选 ")]),_:1},8,["modelValue","indeterminate","onChange"]),e(ne,{modelValue:l(q),"onUpdate:modelValue":r[9]||(r[9]=o=>k(q)?q.value=o:null),onChange:l(ee)},{default:t(()=>[(R(!0),F(J,null,ce(l(Z),(o,S)=>(R(),P(j,{key:S,value:o},{default:t(()=>[m(M(o.roleName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1})]),_:1})]),footer:t(()=>[z("div",Pe,[e(v,{onClick:r[10]||(r[10]=o=>E.value=!1)},{default:t(()=>[m("取消")]),_:1}),e(v,{type:"primary",onClick:l(le)},{default:t(()=>[m("确定")]),_:1},8,["onClick"])])]),_:1},8,["modelValue"])],64)}}}),el=he(Je,[["__scopeId","data-v-7fdf2411"]]);export{el as default};
